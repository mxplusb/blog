    <!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="author" content="mxplusb">
		
		<meta name="generator" content="Hugo 0.19-DEV" />
		<title>Graphing Gas Prices in Colorado &middot; mxplusb</title>
		<link rel="shortcut icon" href="https://mxplusb.github.io/blog/images/favicon.ico">
		<link rel="stylesheet" href="https://mxplusb.github.io/blog/css/style.css">
		<link rel="stylesheet" href="https://mxplusb.github.io/blog/css/highlight.css">
		

		
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
		

		
		<link href="https://mxplusb.github.io/blog/index.xml" rel="alternate" type="application/rss+xml" title="mxplusb" />
		

		<meta property="og:title" content="Graphing Gas Prices in Colorado" />
<meta property="og:description" content="Drill, baby. Drill, baby, drill." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mxplusb.github.io/blog/blog/colorado-gas-prices/" />


<meta property="og:updated_time" content="2017-01-30T17:46:38-08:00"/>










	    
	    
<meta itemprop="name" content="Graphing Gas Prices in Colorado">
<meta itemprop="description" content="Drill, baby. Drill, baby, drill.">


<meta itemprop="dateModified" content="2017-01-30T17:46:38-08:00" />
<meta itemprop="wordCount" content="977">



<meta itemprop="keywords" content="" />

	    

  <meta name="twitter:card" content="summary"/>



<meta name="twitter:title" content="Graphing Gas Prices in Colorado"/>
<meta name="twitter:description" content="Drill, baby. Drill, baby, drill."/>



	</head>

    <body>
       <nav class="main-nav">
	
	
		<a href='https://mxplusb.github.io/blog/'> <span class="arrow">←</span>There&#39;s No Place Like /</a>
	

	
		<a href='https://mxplusb.github.io/blog/about'>A Really Long Arbitrary Title For A Page About Me</a>
	

	
	<a class="cta" href="https://mxplusb.github.io/blog/index.xml">RSS</a>
	
</nav>

        <section id="wrapper">
            <article class="post">
                <header>
                    <h1>Graphing Gas Prices in Colorado</h1>
                    <h2 class="headline">
                    January 30, 2017 
                    <br>
                    
                    </h2>
                </header>
                <section id="post-body">
                    

<h2 id="setting-up-the-rig">Setting Up the Rig</h2>

<p>I&rsquo;m a lurker. There, I said it. I&rsquo;m sorry, I can&rsquo;t help myself somtimes. I lurk <a href="https://reddit.com/r/dataisbeautiful">/r/dataisbeautiful</a> all the time&hellip;I just really like graphs. They are fun, they look cool, and they&rsquo;re just all around neat.</p>


<figure >
    
        <img src="https://media.giphy.com/media/POjnJ94jaXPSU/giphy.gif" />
    
    
</figure>


<p>They&rsquo;re fun, they can represent really cool data, and they can also help you understand data. Even a rendering of data, not just a representative graph, can change the way data is understood. When filming the movie <a href="https://en.wikipedia.org/wiki/Interstellar_(film)">Interstellar</a>, they consulted well-known physicist Kip Thorne to assist with the proper rendering of Gargantua, the spinning black hole in the film. One of the most interesting discoveries was made:</p>

<blockquote>
<p>“I never expected [Gargantua to look like that],” Thorne says. “Eugénie [von Tunzelmann] just did the simulations and said, ‘Hey, this is what I got.’ It was just amazing.”
&ndash;<a href="https://www.wired.com/2014/10/astrophysics-interstellar-black-hole/">Wired Magazine</a></p>
</blockquote>

<p>When a renown physicist is caught off guard by a data visualization, you know data visualizations have lots of potential. I&rsquo;m going to talk a little bit about how I graphed all the gasoline prices in Colorado, U.S., the tools used, and share the code.</p>

<h4 id="tools">Tools</h4>

<p>To facilitate easy use, I originally wrote all of this in a <a href="https://jupyter-notebook-beginner-guide.readthedocs.io/en/latest/what_is_jupyter.html">Jupyter Notebook</a> to keep things much easier to see, and it was really nice. I&rsquo;ll be pasting the raw code, but it should be easy to copy from here. This is all in Python, and the notebook originally was hosted on Microsoft&rsquo;s <a href="https://studio.azureml.net/">Azure Machine Learning Studio</a> (AMLS).</p>

<p><strong>Libraries:</strong></p>

<ul>
<li><a href="http://pandas.pydata.org/">Pandas</a></li>
<li><a href="https://plot.ly/python/">Plot.ly</a></li>
<li><a href="https://github.com/Azure/Azure-MachineLearning-ClientLibrary-Python">AzureML</a></li>
<li>Data Source: <a href="https://data.colorado.gov/Transportation/Gasoline-prices-in-Colorado/8pk9-mh2i">Colorado Information Marketplace</a></li>
</ul>

<h2 id="bringing-the-equipment-on-site">Bringing the Equipment On-site</h2>

<p>To start, let&rsquo;s go ahead with the <code>import</code>s.</p>

<pre><code class="language-python">import pandas as pd
import plotly.graph_objs as go

from plotly.offline import iplot, init_notebook_mode

# this is required by plotly for offline use in notebooks.
init_notebook_mode()
</code></pre>

<p>Azure ML Studio is still in beta, and external network access is not allowed. When you intialise  <code>plotly</code> for the first time, it&rsquo;s going to compile the <code>matplotlib</code> fonts, you&rsquo;ll see a warning, this is expected behaviour. So, by RTFM, I learned that I had to upload my data set, then create an access key for it. If you <a href="https://docs.microsoft.com/en-us/azure/machine-learning/machine-learning-python-data-access">RTFM</a>, they cover how to create an access key. The UI will auto generate one for you, and it&rsquo;ll look something like this:</p>

<pre><code class="language-python">ws = Workspace(
    # leave it to Microsoft to use single quotes...you bastards.
    workspace_id='...',
    authorization_token='...',
    endpoint='https://studioapi.azureml.net'
)
</code></pre>

<p>Now, to grab the dataset from our data store in AMLS:</p>

<pre><code class="language-python"># the azureml library has a cool builtin function that will take CSV data from the data store and convert it to a pandas DataFrame for us. hashtag  nifty!
ds = ws.datasets['Gasoline_prices_in_Colorado.csv']
df = ds.to_dataframe()

# we're then creating an average of all the all the values in all the columns. you'll see how this comes into play later.
df[&quot;avg&quot;] = df.mean(axis=1)
</code></pre>

<p>Once we have our data, we need to extract each grade of fuel, so we can draw a scatter graphing object.</p>

<pre><code class="language-python">premium_gas = go.Scatter(
    name=&quot;Premium&quot;,
    x=df[&quot;date&quot;],
    y=df[&quot;premiumGasPrice&quot;],
    mode=&quot;lines&quot;,
    marker=dict(color=&quot;444&quot;),
    line=dict(width=0),
    fillcolor='rgba(68, 68, 68, 0.3)',
    fill='tonexty'
)

average_gas = go.Scatter(
    name=&quot;Average&quot;,
    x=df[&quot;date&quot;],
    y=df[&quot;avg&quot;],
    mode=&quot;lines&quot;,
    line=dict(color='rgb(47, 13, 44)'),
    fillcolor='rgba(68, 68, 68, 0.3)',
    fill='tonexty'
)

regular_gas = go.Scatter(
    name=&quot;Regular&quot;,
    x=df[&quot;date&quot;],
    y=df[&quot;regularGasPrice&quot;],
    marker=dict(color=&quot;444&quot;),
    line=dict(width=0),
    mode='lines'
)
</code></pre>

<p>Now, you may have noticed, some of the parameters are different between the three of them. If you look at the data found in the DataFrame:</p>

<pre><code class="language-python">           date allGradesGasPrice  \
845  01/01/2001             $1.47   
472  01/01/2007             $2.21   
606  01/02/2006             $2.21   

    regularGasPrice midgradeGasPrice  \
845           $1.42            $1.54   
472           $2.17            $2.28   
606           $2.17            $2.27   

    premiumGasPrice  
845           $1.64  
472           $2.38  
606           $2.38 
</code></pre>

<p>We can see there is a high, <code>premiumGasPrice</code>, and a low, <code>regularGasPrice</code>. With that, we can expand our graph to look a) more visually pleasing, and b) better represent the data. The type of graph we&rsquo;re building is called an <a href="https://en.wikipedia.org/wiki/Error_bar">Error Bar</a>. More specifically, we&rsquo;re creating a continuous error bar graph, as the data is not missing any fields. Now, normally an error bar graph is designed to show a standard deviation of error in the data. While our data is exact, with no margin of error, we&rsquo;re actually graphing the disparities of the gas prices between regular grade and premium grade gasoline. I&rsquo;ll explain the why at the end, once you seen it.</p>

<p>Let&rsquo;s go ahead and create a layout. See comments in-line.</p>

<pre><code class="language-python"># this is our list our scatter plots.
data = [regular_gas, average_gas, premium_gas]

# we're creating a new layout, with time controls.
layout = go.Layout(
    yaxis=dict(
        # title the graph, and create a nice number format.
        title=&quot;Gasoline Prices in Colorado&quot;,
        hoverformat=&quot;$,.2f&quot;
    ),
    xaxis=dict(
        # plotly.graph_objs.Layout().rangeselector allows us
        # zoom in on the data. more reading: 
        # https://plot.ly/python/range-slider/
        rangeselector=dict(
            buttons=list([
                # so we can sorta data from the last month.
                dict(count=1,
                     label='1m',
                     step='month',
                     stepmode='backward'),
                # so we can sorta data from the last 6 months.
                dict(count=6,
                     label='6m',
                     step='month',
                     stepmode='backward'),
                # so we can sorta data from the last year.
                dict(count=1,
                     label='YTD',
                     step='year',
                     stepmode='todate'),
                dict(count=1,
                     label='1y',
                     step='year',
                     stepmode='backward'),
                dict(step='all')
            ])
        ),
        rangeslider=dict(),
        type='date'
    ),
    # we don't need to see the legend as you can hover over the lines.
    showlegend=False
)
</code></pre>

<p>Now that we&rsquo;ve created all three scatter plots (aka, lines), we need to create a figure, and then plot it!</p>

<pre><code class="language-python">fig = {&quot;data&quot;: data, &quot;layout&quot;: layout}
iplot(fig)
</code></pre>

<p>It should look something like this:</p>


<figure >
    <a href="https://plot.ly/~mxplusb/1#plot">
        <img src="https://i.imgur.com/s4W3ajc.png" />
    </a>
    
</figure>


<p>Now, yours will look a little different from mine. I did some post-processing on Plot.ly and made it look more presentable so it would be acceptable by <a href="https://reddit.com/r/dataisbeautiful">/r/dataisbeautiful</a>. If you click on the image, you can see my final result.</p>

<h2 id="pumping-the-oil">Pumping the Oil</h2>

<p>So now that we&rsquo;ve visualised our data, let&rsquo;s look at it. You should always humbly admire your work. In this case, let&rsquo;s look at a little analysis. You&rsquo;ll notice, data started in the year 2000. The US Energy Information Administration, the original data source, either does not make the data public or doesn&rsquo;t have data before 2000, at least for Colorado.</p>

<p>What do you see in your data?</p>

                </section>
            </article>
            <footer id="post-meta" class="clearfix">
                
                        <img class="avatar" src="https://mxplusb.github.io/blog/images/avatar.png">
                        <div>
                            <span class="dark">mxplusb</span>
                            <span>I just fiddle with random bits of code.</span>
                        </div>
                    
                <section id="sharing">
                    <a class="twitter" href="https://twitter.com/intent/tweet?text=https%3a%2f%2fmxplusb.github.io%2fblog%2fblog%2fcolorado-gas-prices%2f - Graphing%20Gas%20Prices%20in%20Colorado "><span class="icon-twitter"> Tweet</span></a>

<a class="facebook" href="#" onclick="
    window.open(
      'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
      'facebook-share-dialog',
      'width=626,height=436');
    return false;"><span class="icon-facebook-rect"> Share</span>
</a>

                </section>
            </footer>

            

            <ul id="post-list" class="archive readmore">
    <h3>Read more</h3>

    
    
    
        
        <li>
            <a href="https://mxplusb.github.io/blog/blog/colorado-gas-prices/">Graphing Gas Prices in Colorado<aside class="dates">Jan 30</aside></a>
        </li>
        
   
    
        
   
    
        
        <li>
            <a href="https://mxplusb.github.io/blog/blog/the-making-of-this/">Who, What, Why, and How<aside class="dates">Jan 28</aside></a>
        </li>
        
   
</ul>

            <footer id="footer">
    
        <div id="social">

	
	
    <a class="symbol" href="https://www.github.com/mxplusb">
        <i class="fa fa-github"></i>
    </a>
    


</div>

    
    <p class="small">
    
        Copyright 2017 Mike Lloyd
    
    </p>
</footer>

        </section>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://mxplusb.github.io/blog/js/main.js"></script>
<script src="https://mxplusb.github.io/blog/js/highlight.js"></script>
<script>hljs.initHighlightingOnLoad();</script>





    </body>
</html>
